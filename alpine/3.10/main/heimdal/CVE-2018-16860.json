{
  "IssueID": 10511,
  "VulnerabilityID": "CVE-2018-16860",
  "Release": "3.10",
  "Package": "heimdal",
  "Repository": "main",
  "FixedVersion": "7.5.0-r4",
  "Subject": "[3.10] heimdal: S4U2Self with unkeyed checksum (CVE-2018-16860)",
  "Description": "S4U2Self is an extension to Kerberos used in Active Directory to allow\r\na service to request a kerberos ticket to itself from the Kerberos Key\r\nDistribution Center (KDC) for a non-Kerberos authenticated user\r\n(principal in Kerboros parlance). This is useful to allow internal\r\ncode paths to be standardized around Kerberos.\r\n\r\nS4U2Proxy (constrained-delegation) is an extension of this mechanism\r\nallowing this impersonation to a second service over the network. It\r\nallows a privileged server that obtained a S4U2Self ticket to itself\r\nto then assert the identity of that principal to a second service and\r\npresent itself as that principal to get services from the second\r\nservice.\r\n\r\nThere is a flaw in Samba's AD DC in the Heimdal KDC. When the Heimdal\r\nKDC checks the checksum that is placed on the S4U2Self packet by the\r\nserver to protect the requested principal against modification, it\r\ndoes not confirm that the checksum algorithm that protects the user\r\nname (principal) in the request is keyed.  This allows a\r\nman-in-the-middle attacker who can intercept the request to the KDC to\r\nmodify the packet by replacing the user name (principal) in the\r\nrequest with any desired user name (principal) that exists in the KDC\r\nand replace the checksum protecting that name with a CRC32 checksum\r\n(which requires no prior knowledge to compute).\r\n\r\nThis would allow a S4U2Self ticket requested on behalf of user name\r\n(principal) user@EXAMPLE.COM to any service to be changed to a\r\nS4U2Self ticket with a user name (principal) of\r\nAdministrator@EXAMPLE.COM. This ticket would then contain the PAC of\r\nthe modified user name (principal).\r\n\r\nh3. Affected Versions:\r\n\r\nAll releases of Heimdal from 0.8 including 7.5.0\r\n\r\nh3. Reference:\r\n\r\nhttps://github.com/heimdal/heimdal/commit/c6257cc2c842c0faaeb4ef34e33890ee88c4cbba\r\nhttps://www.samba.org/samba/security/CVE-2018-16860.html\r\n\r\nh3. Patch:\r\n\r\nhttps://github.com/heimdal/heimdal/commit/c6257cc2c842c0faaeb4ef34e33890ee88c4cbba\r\n"
}