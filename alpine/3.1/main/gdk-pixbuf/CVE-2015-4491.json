{
  "IssueID": 4530,
  "VulnerabilityID": "CVE-2015-4491",
  "Release": "3.1",
  "Package": "gdk-pixbuf",
  "Repository": "main",
  "FixedVersion": "2.31.5-r0",
  "Subject": "[v3.1] gdk-pixbuf: heap overflow and DoS affecting Firefox and other programs [x86_64] (CVE-2015-4491) ",
  "Description": "We found a heap overflow and a DoS in the gdk-pixbuf implementation triggered by the scaling of a malformed bmp. These issues are affecting x86_64 builds (we tested in a fully updated Ubuntu 14.04 and Debian Wheezy). For example, Ubuntu 14.04 ships with gdk-pixbuf 2.30 but newer versions are affected as well.\r\n\r\nThe issue happens when a program is trying to parse and scale a crafted bmp using gdk-pixbuf (for instance, using get_scaled_pixbuf). It will result at least in an DoS aborting the program with a SIGTRAP. It is also possible to perform a heap overflow if you select the suitable width and height in a malicious bmp according to the scaled width and height. The cause of the heap overflow is this integer overflow located here:\r\nhttps://github.com/GNOME/gdk-pixbuf/blob/f79085cbec9997895e252dce994d18139d719e26/gdk-pixbuf/pixops/pixops.c#L1275\r\nand the insufficient checks performed in the gdk_pixbuf_new function.\r\n\r\nInterestingly enough, in a recent version of gdk-pixbuf (2.31 or newer) somebody replaced some old code that checks for a overflow with a g_try_malloc_n that is supposed to check for overflow, but it doesn't in x86_64 (you can see the old and new code here:\r\nhttps://github.com/GNOME/gdk-pixbuf/commit/deb78d971c4bcb9e3ccbb71e7925bc6baa707188#diff-cde3af8b5b1c0789407148d53a75\r\nae22R448)\r\n\r\nUnfortunately, at least Firefox and Chromium are using gdk-pixbuf primitives to implement file pickers, so they are affected. A minimal example of a vulnerable program is attached: it is just a call to gdk_pixbuf_new_from_file_at_size. Also two bmp POC are included: one to crash the minimal example and another POC to trigger a heap overflow in Firefox (it works with pixbuf 2.31 or newer). You should attach the uncompressed bmp or try to open it (using ctrl+O) (that's the reason we are sending it compressed!). Remember that this vulnerability depends on a malloc call and can fail if your real/virtual memory is not large enough. In particular, the Firefox POC requires at least 12GB of memory available for allocation.\r\n\r\nReference:\r\n\u003e https://bugzilla.gnome.org/show_bug.cgi?id=752297\r\n"
}